<%- include("../partials/head", {pageTitle: "Registrarme", stylesheet: "register.css"}) %>

<% if(typeof(errors) != 'undefined'){%>
    <ul class="alert alert-danger">
       <% errors.forEach(error => { %>
          <li><%= error.msg%></li>
       <%});%>
     </ul>
 <%}%>      
    <header>
        
        <p class="barrasMenu"><i class="fas fa-bars"></i></p>
        <a href="/">
            <img class="logo" src="images/logoConTitulo.png" height="45px">
        </a>
    </header>

    <div class="contenedor-logo">
        <a href="/">
            <img class="logo2" src="/images/isologoNaranja.png">
        </a>
    </div>
    
    
    <form action="/users/register" method="POST" enctype="multipart/form-data">

        <div class="titulo">
            <h2>COMPLETA TUS DATOS</h2>
        </div>

        <div class="campo-form">
            <label>Nombre</label>
            <input type="text" name="firstName" id="firstName" value="<%= typeof old != 'undefined' ? old.firstName : '' %>">
            <div class="error" id="name-error"></div>
        </div>
            
        </div>

        <div class="campo-form">
            <label>Apellido</label>
            <input type="text" name="lastName" id="lastName" value="<%= typeof old != 'undefined' ? old.LastName : '' %>" required>
            <div id="lastName-error" class="error"></div>
        </div>
        
        <div class="campo-form">
            <label>Email</label>
            <input type="email" name="email" id="email" value="<%= typeof old != 'undefined' ? old.email : '' %>" required>
            <div id="email-error" class="error"></div>
          </div>
        <div class="campo-form">
            <div class="radio-buttons">
                <div>
                    <label>Comprador</label>
                    <input type="radio" name="type" value="1"required>
                </div>
                <div>
                    <label>Vendedor</label>
                    <input type="radio" name="type" value="2" required>
                </div>
            </div>
        </div>

        <div class="campo-form">
            <label>Agrega una foto</label>
            <input class="imagen-input" type="file" name="avatar" id="imagen" >
            <div id="imagen-error" class="error"></div>
        </div>

        <div class="campo-form">
            <label>Contraseña</label>
            <div id="password-error" class="error"></div>
            <input type="password" name="password"  id = "password" required>
            
        </div>

        <div class="caja-boton">
            <button type="submit">CREA TU CUENTA</button>
        </div>
    </form>
    <script>
        
        window.addEventListener('load', function() {

   
 


// Nombre
const nameField = document.querySelector("#firstName");
const nameError = document.querySelector("#name-error");

nameField.addEventListener("blur", function() {
    if (nameField.value.length < 2) {
        nameError.innerHTML = "El nombre debe tener 2 caracteres minimo";
    } else {
        nameError.innerHTML = "";
    }
});

// Apellido
const lastNameField = document.querySelector("#lastName");
const lastNameError = document.querySelector("#lastName-error");

lastNameField.addEventListener("blur", function() {
if (lastNameField.value.length < 2) {
lastNameError.innerHTML = "El apellido debe tener 2 caracteres minimo";
} else {
lastNameError.innerHTML = "";
}
});

// Email

  // Validación de email
  const emailField = document.querySelector("#email");
  const emailError = document.querySelector("#email-error");

  emailField.addEventListener("blur", function() {
    // Verifica si el correo electrónico es válido
    if (!/\S+@\S+\.\S+/.test(emailField.value)) {
      emailError.innerHTML = "Ingrese un correo electrónico válido";
    } else {
      // Verifica si el correo electrónico existe en la base de datos
      // Se puede hacer una consulta ajax o usar algún otro método para verificar si existe en la base de datos
      emailError.innerHTML = "";
    }
  });



// Contraseña
const passwordInput = document.querySelector("#password");
const passwordError = document.querySelector("#password-error");

passwordInput.addEventListener("blur", function() {
    if (passwordInput.value.length < 8) {
        passwordError.innerHTML = "La contraseña debe tener al menos 8 caracteres";
    } else {
        passwordError.innerHTML = "";
    }
});


// Imagen
// Validación de formato de imagen en el lado del cliente
function validateImage(input) {
  const image = input.files[0];
  const allowedTypes = ['jpg', 'jpeg', 'png', 'gif'];
  const imageType = image.name.split('.').pop().toLowerCase();

  if (!allowedTypes.includes(imageType)) {
    alert('Deberá ser un archivo válido (JPG, JPEG, PNG, GIF)');
    return false;
  }

  return true;
}

// Asociar la validación de la imagen con el evento onsubmit del formulario
const form = document.getElementById('myForm');
form.onsubmit = function(event) {
  const input = document.getElementById('image');
  if (!validateImage(input)) {
    event.preventDefault();
  }
};
});
    </script>

</body>

</html>